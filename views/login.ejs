<!DOCTYPE html>
<html>
  <head>
    <% include head.ejs %>

    <link rel='stylesheet' href="loginstyle.css" />
  </head>

  <body>
    <!-- header -->
    <% include header.ejs %>

    <div id="bulk">
      <div class="input">
        <p>Email:</p>
        <p><input id="email" type="username"></p>

        <p>Password:</p>
        <p><input id="password" type="password"></p>
      </div>

      <div class="button">
        <button>
          Login
        </button>
      </div>
      <div class="register">
        <p>New User? <a href="/register"><span>Register here.</span></a></p>
      </div>
    </div>


    <script>
        // // carry cart over
        // $.ajax({
        //   url: "http://localhost:3000/cart",
        //   type: "GET",
        //   success: function(e){
        //     var cart = e;
        //
        //     var cartNumber = 0;
        //
        //     for (var i = 0; i < cart.length; i++){
        //         cartNumber += parseInt(cart[i]["quantity"]);
        //     }
        //
        //     $("#cart").html("Cart (" + cartNumber + ")");
        //   }
        // });

        $('.button').on('click', 'button', function(e){

          var pass = $('#password').val();

          var email = $('#email').val();

          var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;

          if(!re.test(email)){
            alert("Invalid email format");
            return;
          }

          // check if user/pass is in database
          $.ajax({
            url: 'http://localhost:3000/users/login',
            type: "POST",
            data: {username: email, password: pass},
            success: function(e){
              //console.log(e)

              if(e){
                alert("login successful");
                window.location = "/";
              } else{
                alert("login failed");
                window.location = "/login";
              }
            }
          })
        })
    </script>
  </body>
</html>
